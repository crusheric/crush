"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "generateSubmissionCollection", {
    enumerable: true,
    get: function() {
        return generateSubmissionCollection;
    }
});
const _createCharge = /*#__PURE__*/ _interop_require_default(require("./hooks/createCharge"));
const _sendEmail = /*#__PURE__*/ _interop_require_default(require("./hooks/sendEmail"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const generateSubmissionCollection = (formConfig)=>{
    const formSlug = formConfig?.formOverrides?.slug || 'forms';
    const newConfig = {
        ...formConfig?.formSubmissionOverrides || {},
        access: {
            create: ()=>true,
            read: ({ req: { user } })=>!!user,
            update: ()=>false,
            ...formConfig?.formSubmissionOverrides?.access || {}
        },
        admin: {
            ...formConfig?.formSubmissionOverrides?.admin || {},
            enableRichTextRelationship: false
        },
        fields: [
            {
                name: 'form',
                admin: {
                    readOnly: true
                },
                relationTo: formSlug,
                required: true,
                type: 'relationship',
                validate: async (value, { payload })=>{
                    /* Don't run in the client side */ if (!payload) return true;
                    if (payload) {
                        let existingForm;
                        try {
                            existingForm = await payload.findByID({
                                id: value,
                                collection: formSlug
                            });
                            return true;
                        } catch (error) {
                            return 'Cannot create this submission because this form does not exist.';
                        }
                    }
                }
            },
            {
                name: 'submissionData',
                admin: {
                    readOnly: true
                },
                fields: [
                    {
                        name: 'field',
                        required: true,
                        type: 'text'
                    },
                    {
                        name: 'value',
                        required: true,
                        type: 'text',
                        validate: (value)=>{
                            // TODO:
                            // create a validation function that dynamically
                            // relies on the field type and its options as configured.
                            // How to access sibling data from this field?
                            // Need the `name` of the field in order to validate it.
                            // Might not be possible to use this validation function.
                            // Instead, might need to do all validation in a `beforeValidate` collection hook.
                            if (typeof value !== 'undefined') {
                                return true;
                            }
                            return 'This field is required.';
                        }
                    }
                ],
                type: 'array'
            },
            ...formConfig?.formSubmissionOverrides?.fields || []
        ],
        hooks: {
            beforeChange: [
                (data)=>(0, _createCharge.default)(data, formConfig),
                (data)=>(0, _sendEmail.default)(data, formConfig),
                ...formConfig?.formSubmissionOverrides?.hooks?.beforeChange || []
            ],
            ...formConfig?.formSubmissionOverrides?.hooks || {}
        },
        slug: formConfig?.formSubmissionOverrides?.slug || 'form-submissions'
    };
    const paymentFieldConfig = formConfig?.fields?.payment;
    if (paymentFieldConfig) {
        newConfig.fields.push({
            name: 'payment',
            admin: {
                readOnly: true
            },
            fields: [
                {
                    name: 'field',
                    label: 'Field',
                    type: 'text'
                },
                {
                    name: 'status',
                    label: 'Status',
                    type: 'text'
                },
                {
                    name: 'amount',
                    admin: {
                        description: 'Amount in cents'
                    },
                    type: 'number'
                },
                {
                    name: 'paymentProcessor',
                    type: 'text'
                },
                {
                    name: 'creditCard',
                    fields: [
                        {
                            name: 'token',
                            label: 'token',
                            type: 'text'
                        },
                        {
                            name: 'brand',
                            label: 'Brand',
                            type: 'text'
                        },
                        {
                            name: 'number',
                            label: 'Number',
                            type: 'text'
                        }
                    ],
                    label: 'Credit Card',
                    type: 'group'
                }
            ],
            type: 'group'
        });
    }
    return newConfig;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb2xsZWN0aW9ucy9Gb3JtU3VibWlzc2lvbnMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDb2xsZWN0aW9uQ29uZmlnIH0gZnJvbSAncGF5bG9hZC90eXBlcydcblxuaW1wb3J0IHR5cGUgeyBQbHVnaW5Db25maWcgfSBmcm9tICcuLi8uLi90eXBlcydcblxuaW1wb3J0IGNyZWF0ZUNoYXJnZSBmcm9tICcuL2hvb2tzL2NyZWF0ZUNoYXJnZSdcbmltcG9ydCBzZW5kRW1haWwgZnJvbSAnLi9ob29rcy9zZW5kRW1haWwnXG5cbi8vIGFsbCBzZXR0aW5ncyBjYW4gYmUgb3ZlcnJpZGRlbiBieSB0aGUgY29uZmlnXG5leHBvcnQgY29uc3QgZ2VuZXJhdGVTdWJtaXNzaW9uQ29sbGVjdGlvbiA9IChmb3JtQ29uZmlnOiBQbHVnaW5Db25maWcpOiBDb2xsZWN0aW9uQ29uZmlnID0+IHtcbiAgY29uc3QgZm9ybVNsdWcgPSBmb3JtQ29uZmlnPy5mb3JtT3ZlcnJpZGVzPy5zbHVnIHx8ICdmb3JtcydcblxuICBjb25zdCBuZXdDb25maWc6IENvbGxlY3Rpb25Db25maWcgPSB7XG4gICAgLi4uKGZvcm1Db25maWc/LmZvcm1TdWJtaXNzaW9uT3ZlcnJpZGVzIHx8IHt9KSxcbiAgICBhY2Nlc3M6IHtcbiAgICAgIGNyZWF0ZTogKCkgPT4gdHJ1ZSxcbiAgICAgIHJlYWQ6ICh7IHJlcTogeyB1c2VyIH0gfSkgPT4gISF1c2VyLCAvLyBsb2dnZWQtaW4gdXNlcnMsXG4gICAgICB1cGRhdGU6ICgpID0+IGZhbHNlLFxuICAgICAgLi4uKGZvcm1Db25maWc/LmZvcm1TdWJtaXNzaW9uT3ZlcnJpZGVzPy5hY2Nlc3MgfHwge30pLFxuICAgIH0sXG4gICAgYWRtaW46IHtcbiAgICAgIC4uLihmb3JtQ29uZmlnPy5mb3JtU3VibWlzc2lvbk92ZXJyaWRlcz8uYWRtaW4gfHwge30pLFxuICAgICAgZW5hYmxlUmljaFRleHRSZWxhdGlvbnNoaXA6IGZhbHNlLFxuICAgIH0sXG4gICAgZmllbGRzOiBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdmb3JtJyxcbiAgICAgICAgYWRtaW46IHtcbiAgICAgICAgICByZWFkT25seTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVsYXRpb25UbzogZm9ybVNsdWcsXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICB0eXBlOiAncmVsYXRpb25zaGlwJyxcbiAgICAgICAgdmFsaWRhdGU6IGFzeW5jICh2YWx1ZSwgeyBwYXlsb2FkIH0pID0+IHtcbiAgICAgICAgICAvKiBEb24ndCBydW4gaW4gdGhlIGNsaWVudCBzaWRlICovXG4gICAgICAgICAgaWYgKCFwYXlsb2FkKSByZXR1cm4gdHJ1ZVxuXG4gICAgICAgICAgaWYgKHBheWxvYWQpIHtcbiAgICAgICAgICAgIGxldCBleGlzdGluZ0Zvcm1cblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgZXhpc3RpbmdGb3JtID0gYXdhaXQgcGF5bG9hZC5maW5kQnlJRCh7XG4gICAgICAgICAgICAgICAgaWQ6IHZhbHVlLFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IGZvcm1TbHVnLFxuICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICByZXR1cm4gJ0Nhbm5vdCBjcmVhdGUgdGhpcyBzdWJtaXNzaW9uIGJlY2F1c2UgdGhpcyBmb3JtIGRvZXMgbm90IGV4aXN0LidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnc3VibWlzc2lvbkRhdGEnLFxuICAgICAgICBhZG1pbjoge1xuICAgICAgICAgIHJlYWRPbmx5OiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBmaWVsZHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnZmllbGQnLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAndmFsdWUnLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICB2YWxpZGF0ZTogKHZhbHVlOiB1bmtub3duKSA9PiB7XG4gICAgICAgICAgICAgIC8vIFRPRE86XG4gICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIHZhbGlkYXRpb24gZnVuY3Rpb24gdGhhdCBkeW5hbWljYWxseVxuICAgICAgICAgICAgICAvLyByZWxpZXMgb24gdGhlIGZpZWxkIHR5cGUgYW5kIGl0cyBvcHRpb25zIGFzIGNvbmZpZ3VyZWQuXG5cbiAgICAgICAgICAgICAgLy8gSG93IHRvIGFjY2VzcyBzaWJsaW5nIGRhdGEgZnJvbSB0aGlzIGZpZWxkP1xuICAgICAgICAgICAgICAvLyBOZWVkIHRoZSBgbmFtZWAgb2YgdGhlIGZpZWxkIGluIG9yZGVyIHRvIHZhbGlkYXRlIGl0LlxuXG4gICAgICAgICAgICAgIC8vIE1pZ2h0IG5vdCBiZSBwb3NzaWJsZSB0byB1c2UgdGhpcyB2YWxpZGF0aW9uIGZ1bmN0aW9uLlxuICAgICAgICAgICAgICAvLyBJbnN0ZWFkLCBtaWdodCBuZWVkIHRvIGRvIGFsbCB2YWxpZGF0aW9uIGluIGEgYGJlZm9yZVZhbGlkYXRlYCBjb2xsZWN0aW9uIGhvb2suXG5cbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuICdUaGlzIGZpZWxkIGlzIHJlcXVpcmVkLidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgdHlwZTogJ2FycmF5JyxcbiAgICAgIH0sXG4gICAgICAuLi4oZm9ybUNvbmZpZz8uZm9ybVN1Ym1pc3Npb25PdmVycmlkZXM/LmZpZWxkcyB8fCBbXSksXG4gICAgXSxcbiAgICBob29rczoge1xuICAgICAgYmVmb3JlQ2hhbmdlOiBbXG4gICAgICAgIChkYXRhKSA9PiBjcmVhdGVDaGFyZ2UoZGF0YSwgZm9ybUNvbmZpZyksXG4gICAgICAgIChkYXRhKSA9PiBzZW5kRW1haWwoZGF0YSwgZm9ybUNvbmZpZyksXG4gICAgICAgIC4uLihmb3JtQ29uZmlnPy5mb3JtU3VibWlzc2lvbk92ZXJyaWRlcz8uaG9va3M/LmJlZm9yZUNoYW5nZSB8fCBbXSksXG4gICAgICBdLFxuICAgICAgLi4uKGZvcm1Db25maWc/LmZvcm1TdWJtaXNzaW9uT3ZlcnJpZGVzPy5ob29rcyB8fCB7fSksXG4gICAgfSxcbiAgICBzbHVnOiBmb3JtQ29uZmlnPy5mb3JtU3VibWlzc2lvbk92ZXJyaWRlcz8uc2x1ZyB8fCAnZm9ybS1zdWJtaXNzaW9ucycsXG4gIH1cblxuICBjb25zdCBwYXltZW50RmllbGRDb25maWcgPSBmb3JtQ29uZmlnPy5maWVsZHM/LnBheW1lbnRcblxuICBpZiAocGF5bWVudEZpZWxkQ29uZmlnKSB7XG4gICAgbmV3Q29uZmlnLmZpZWxkcy5wdXNoKHtcbiAgICAgIG5hbWU6ICdwYXltZW50JyxcbiAgICAgIGFkbWluOiB7XG4gICAgICAgIHJlYWRPbmx5OiB0cnVlLFxuICAgICAgfSxcbiAgICAgIGZpZWxkczogW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2ZpZWxkJyxcbiAgICAgICAgICBsYWJlbDogJ0ZpZWxkJyxcbiAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnc3RhdHVzJyxcbiAgICAgICAgICBsYWJlbDogJ1N0YXR1cycsXG4gICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2Ftb3VudCcsXG4gICAgICAgICAgYWRtaW46IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQW1vdW50IGluIGNlbnRzJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3BheW1lbnRQcm9jZXNzb3InLFxuICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdjcmVkaXRDYXJkJyxcbiAgICAgICAgICBmaWVsZHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbmFtZTogJ3Rva2VuJyxcbiAgICAgICAgICAgICAgbGFiZWw6ICd0b2tlbicsXG4gICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdicmFuZCcsXG4gICAgICAgICAgICAgIGxhYmVsOiAnQnJhbmQnLFxuICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBuYW1lOiAnbnVtYmVyJyxcbiAgICAgICAgICAgICAgbGFiZWw6ICdOdW1iZXInLFxuICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgbGFiZWw6ICdDcmVkaXQgQ2FyZCcsXG4gICAgICAgICAgdHlwZTogJ2dyb3VwJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICB0eXBlOiAnZ3JvdXAnLFxuICAgIH0pXG4gIH1cblxuICByZXR1cm4gbmV3Q29uZmlnXG59XG4iXSwibmFtZXMiOlsiZ2VuZXJhdGVTdWJtaXNzaW9uQ29sbGVjdGlvbiIsImZvcm1Db25maWciLCJmb3JtU2x1ZyIsImZvcm1PdmVycmlkZXMiLCJzbHVnIiwibmV3Q29uZmlnIiwiZm9ybVN1Ym1pc3Npb25PdmVycmlkZXMiLCJhY2Nlc3MiLCJjcmVhdGUiLCJyZWFkIiwicmVxIiwidXNlciIsInVwZGF0ZSIsImFkbWluIiwiZW5hYmxlUmljaFRleHRSZWxhdGlvbnNoaXAiLCJmaWVsZHMiLCJuYW1lIiwicmVhZE9ubHkiLCJyZWxhdGlvblRvIiwicmVxdWlyZWQiLCJ0eXBlIiwidmFsaWRhdGUiLCJ2YWx1ZSIsInBheWxvYWQiLCJleGlzdGluZ0Zvcm0iLCJmaW5kQnlJRCIsImlkIiwiY29sbGVjdGlvbiIsImVycm9yIiwiaG9va3MiLCJiZWZvcmVDaGFuZ2UiLCJkYXRhIiwiY3JlYXRlQ2hhcmdlIiwic2VuZEVtYWlsIiwicGF5bWVudEZpZWxkQ29uZmlnIiwicGF5bWVudCIsInB1c2giLCJsYWJlbCIsImRlc2NyaXB0aW9uIl0sIm1hcHBpbmdzIjoiOzs7OytCQVFhQTs7O2VBQUFBOzs7cUVBSlk7a0VBQ0g7Ozs7OztBQUdmLE1BQU1BLCtCQUErQixDQUFDQztJQUMzQyxNQUFNQyxXQUFXRCxZQUFZRSxlQUFlQyxRQUFRO0lBRXBELE1BQU1DLFlBQThCO1FBQ2xDLEdBQUlKLFlBQVlLLDJCQUEyQixDQUFDLENBQUM7UUFDN0NDLFFBQVE7WUFDTkMsUUFBUSxJQUFNO1lBQ2RDLE1BQU0sQ0FBQyxFQUFFQyxLQUFLLEVBQUVDLElBQUksRUFBRSxFQUFFLEdBQUssQ0FBQyxDQUFDQTtZQUMvQkMsUUFBUSxJQUFNO1lBQ2QsR0FBSVgsWUFBWUsseUJBQXlCQyxVQUFVLENBQUMsQ0FBQztRQUN2RDtRQUNBTSxPQUFPO1lBQ0wsR0FBSVosWUFBWUsseUJBQXlCTyxTQUFTLENBQUMsQ0FBQztZQUNwREMsNEJBQTRCO1FBQzlCO1FBQ0FDLFFBQVE7WUFDTjtnQkFDRUMsTUFBTTtnQkFDTkgsT0FBTztvQkFDTEksVUFBVTtnQkFDWjtnQkFDQUMsWUFBWWhCO2dCQUNaaUIsVUFBVTtnQkFDVkMsTUFBTTtnQkFDTkMsVUFBVSxPQUFPQyxPQUFPLEVBQUVDLE9BQU8sRUFBRTtvQkFDakMsZ0NBQWdDLEdBQ2hDLElBQUksQ0FBQ0EsU0FBUyxPQUFPO29CQUVyQixJQUFJQSxTQUFTO3dCQUNYLElBQUlDO3dCQUVKLElBQUk7NEJBQ0ZBLGVBQWUsTUFBTUQsUUFBUUUsUUFBUSxDQUFDO2dDQUNwQ0MsSUFBSUo7Z0NBQ0pLLFlBQVl6Qjs0QkFDZDs0QkFFQSxPQUFPO3dCQUNULEVBQUUsT0FBTzBCLE9BQU87NEJBQ2QsT0FBTzt3QkFDVDtvQkFDRjtnQkFDRjtZQUNGO1lBQ0E7Z0JBQ0VaLE1BQU07Z0JBQ05ILE9BQU87b0JBQ0xJLFVBQVU7Z0JBQ1o7Z0JBQ0FGLFFBQVE7b0JBQ047d0JBQ0VDLE1BQU07d0JBQ05HLFVBQVU7d0JBQ1ZDLE1BQU07b0JBQ1I7b0JBQ0E7d0JBQ0VKLE1BQU07d0JBQ05HLFVBQVU7d0JBQ1ZDLE1BQU07d0JBQ05DLFVBQVUsQ0FBQ0M7NEJBQ1QsUUFBUTs0QkFDUixnREFBZ0Q7NEJBQ2hELDBEQUEwRDs0QkFFMUQsOENBQThDOzRCQUM5Qyx3REFBd0Q7NEJBRXhELHlEQUF5RDs0QkFDekQsa0ZBQWtGOzRCQUVsRixJQUFJLE9BQU9BLFVBQVUsYUFBYTtnQ0FDaEMsT0FBTzs0QkFDVDs0QkFFQSxPQUFPO3dCQUNUO29CQUNGO2lCQUNEO2dCQUNERixNQUFNO1lBQ1I7ZUFDSW5CLFlBQVlLLHlCQUF5QlMsVUFBVSxFQUFFO1NBQ3REO1FBQ0RjLE9BQU87WUFDTEMsY0FBYztnQkFDWixDQUFDQyxPQUFTQyxJQUFBQSxxQkFBWSxFQUFDRCxNQUFNOUI7Z0JBQzdCLENBQUM4QixPQUFTRSxJQUFBQSxrQkFBUyxFQUFDRixNQUFNOUI7bUJBQ3RCQSxZQUFZSyx5QkFBeUJ1QixPQUFPQyxnQkFBZ0IsRUFBRTthQUNuRTtZQUNELEdBQUk3QixZQUFZSyx5QkFBeUJ1QixTQUFTLENBQUMsQ0FBQztRQUN0RDtRQUNBekIsTUFBTUgsWUFBWUsseUJBQXlCRixRQUFRO0lBQ3JEO0lBRUEsTUFBTThCLHFCQUFxQmpDLFlBQVljLFFBQVFvQjtJQUUvQyxJQUFJRCxvQkFBb0I7UUFDdEI3QixVQUFVVSxNQUFNLENBQUNxQixJQUFJLENBQUM7WUFDcEJwQixNQUFNO1lBQ05ILE9BQU87Z0JBQ0xJLFVBQVU7WUFDWjtZQUNBRixRQUFRO2dCQUNOO29CQUNFQyxNQUFNO29CQUNOcUIsT0FBTztvQkFDUGpCLE1BQU07Z0JBQ1I7Z0JBQ0E7b0JBQ0VKLE1BQU07b0JBQ05xQixPQUFPO29CQUNQakIsTUFBTTtnQkFDUjtnQkFDQTtvQkFDRUosTUFBTTtvQkFDTkgsT0FBTzt3QkFDTHlCLGFBQWE7b0JBQ2Y7b0JBQ0FsQixNQUFNO2dCQUNSO2dCQUNBO29CQUNFSixNQUFNO29CQUNOSSxNQUFNO2dCQUNSO2dCQUNBO29CQUNFSixNQUFNO29CQUNORCxRQUFRO3dCQUNOOzRCQUNFQyxNQUFNOzRCQUNOcUIsT0FBTzs0QkFDUGpCLE1BQU07d0JBQ1I7d0JBQ0E7NEJBQ0VKLE1BQU07NEJBQ05xQixPQUFPOzRCQUNQakIsTUFBTTt3QkFDUjt3QkFDQTs0QkFDRUosTUFBTTs0QkFDTnFCLE9BQU87NEJBQ1BqQixNQUFNO3dCQUNSO3FCQUNEO29CQUNEaUIsT0FBTztvQkFDUGpCLE1BQU07Z0JBQ1I7YUFDRDtZQUNEQSxNQUFNO1FBQ1I7SUFDRjtJQUVBLE9BQU9mO0FBQ1QifQ==